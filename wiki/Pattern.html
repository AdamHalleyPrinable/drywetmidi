<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title> | DryWetMIDI </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content=" | DryWetMIDI ">
    <meta name="generator" content="docfx 2.51.0.0">
    
    <link rel="shortcut icon" href="../images/favicon.png">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">

<p>DryWetMIDI provides a way to create a MIDI file in more &quot;musical&quot; manner. The key class here is the <code>PatternBuilder</code> which allows to build a musical composition. <code>PatternBuilder</code> provides a fluent interface to program the music. For example, you can insert a note like this:</p>
<pre><code class="lang-csharp">using Melanchall.DryWetMidi.Composing;

var patternBuilder = new PatternBuilder()

    // Insert the A4 note with length of 5/17 and velocity of 68
    .Note(Octave.Get(4).A,
          new MusicalTimeSpan(5, 17),
          (SevenBitNumber)68)

    // Insert the G#3 note with default length and velocity
    .Note(Octave.Get(3).GSharp);
</code></pre>
<p>In the example above the last <code>Note</code> method inserts a note with default length and velocity that can be set via corresponding methods at any moment:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()
    .SetNoteLength(MusicalTimeSpan.Half)
    .SetVelocity((SevenBitNumber)50)

    // All the following notes will have half length and velocity of 50
    .Note(Octave.Get(4).A)
    .Note(Note.Get(NoteName.B, 1))
    .Note(-Interval.Two)

    .SetNoteLength(MusicalTimeSpan.Quarter)

    // All the following notes will have quarter length
    .Note(Octave.Get(2).A);
</code></pre>
<p><code>.Note(-Interval.Two)</code> inserts a note that has the pitch of two half steps down of a root note. The default root note is C4 but you can set it to another one:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()
    .SetRootNote(Note.Get(NoteName.A, 2))

    // All the following intervals will be calculated relative to the A2
    .Note(Interval.One)          // A2 + 1  (A#2)
    .Note(Interval.Four)         // A2 + 4  (C#3)
    .Note(-Interval.One)         // A2 - 1  (G#2)
    .Note(-Interval.Twelve * 2)  // A2 - 24 (A0);
</code></pre>
<p>Also you can set default octave:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()
    .SetOctave(Octave.Get(4))
     
    // All the following notes will be of 5th octave
    .Note(NoteName.CSharp)
    .Note(NoteName.G);
</code></pre>
<p>All the <code>Note</code>, <code>Octave</code> and <code>Inerval</code> classes are placed in <code>Melanchall.DryWetMidi.MusicTheory</code> namespace. Read <a href="Music-theory.html">Music theory</a> article to learn more.</p>
<p>Of course you can insert chords. Chord is just a group of notes starting at the same time, so all the techniques described above work for chords too:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()
    .SetNoteLength(MusicalTimeSpan.Half)
    .SetVelocity((SevenBitNumber)50)

    // Insert a chord of A5 and A6
    .Chord(new[] { Note.Get(NoteName.A, 5),
                   Note.Get(NoteName.A, 6) })

    // Insert a chord of E5, F#5 and A#5
    .Chord(new[] { -Interval.Two,
                   Interval.Four },
           Octave.Get(5).FSharp);
</code></pre>
<p>The last <code>Chord</code> method in the code above also takes a root note for it to know what notes should be produced by the passed intervals. The root note also will be a part of the chord.</p>
<p>Both <code>Note</code> and <code>Chord</code> methods insert an object at the current time that can be changed:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()

    // Add a pause of 1 minute and 30 seconds
    .StepForward(new MetricTimeSpan(0, 1, 30))

    // Now a note will be inserted at time of 1 minute and 30 seconds
    .Note(NoteName.G)

    // Jump to time of 2 bars
    .MoveToTime(new BarBeatTicksTimeSpan(2, 0))

    // Step back by quarter note length
    .StepBack(MusicalTimeSpan.Quarter)

    // Now a note will be inserted at time of 2 bars minus
    // quarter note length
    .Note(NoteName.A)
    .Note(NoteName.CSharp)

    // Step back by default step
    StepBack();
</code></pre>
<p>Of course you can specify an instrument that should be used to play notes. There is method <code>ProgramChange</code> for that:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()

    // You can set program with just a program number...
    .ProgramChange((SevenBitNumber)100)
    .Note(NoteName.A)

    // ... or via General MIDI constant...
    .ProgramChange(GeneralMidiProgram.Accordion)

    // ... or via General MIDI Level 2 constant
    .ProgramChange(GeneralMidi2Program.AcousticGrandPianoWide);
</code></pre>
<p>If you call <code>StepForward</code> or <code>StepBack</code> without an argument the default step size will be used. It is quarter note length by default but it can be changed:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()

    // Set default step to 2 minutes
    .SetStep(new MetricTimeSpan(0, 2, 0))

    // Step forward by two minutes
    .StepForward()

    // Step back by two minutes
    .StepBack();
</code></pre>
<p>Every call of <code>Note</code> and <code>Chord</code> moves the current time by the length of inserted object. You can return to the previous current time using <code>MoveToPreviousTime</code> method.</p>
<p>Another feature of the pattern building is anchoring of the current time:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()

    // Add a pause of 1 minute and 30 seconds
    .StepForward(new MetricTimeSpan(0, 1, 30))

    // Save the current time
    .Anchor()

    // Save the current time attaching some key
    .Anchor(&quot;Label 1&quot;);
</code></pre>
<p>Key of an anchor is an arbitrary <code>object</code>. But anchors are useless without ability to jump to them. There are following methods for moving to anchors:</p>
<ul>
<li><code>MoveToFirstAnchor</code> that changes the current time to the time of first added anchor;</li>
<li><code>MoveToLastAnchor</code> that changes the current time to the time of last added anchor;</li>
<li><code>MoveToNthAnchor</code> that changes the current time to the time of n-th anchor.</li>
</ul>
<p>If you use overloads without a key all anchors (keyed and unkeyed) will be taken into consideration to jump to specific one.</p>
<p>Once you've finished building a composition call the <code>Build</code> method which returns an instance of the <code>Pattern</code> class. Pattern contains all the actions made with the builder and can be exported to a file or track chunk:</p>
<pre><code class="lang-csharp">Pattern pattern = patternBuilder.Build();

MidiFile midiFile = pattern.ToFile(TempoMap.Default);
</code></pre>
<p>You can also insert a pattern working with <code>PatternBuilder</code>:</p>
<pre><code class="lang-csharp">var patternBuilder = new PatternBuilder()
    .Pattern(pattern1)
    .Pattern(pattern2);
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Generated by <b>DocFX</b> on March 20, 2020 14:48:50
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
